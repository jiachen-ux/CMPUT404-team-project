{% extends 'base.html' %}
{% block head_title%}
this is amazing
    {% endblock head_title%}
{% block content%}

<div class='row text-center'>
    <div class='col'>
        <h2> Welcome to the app</h2>
    </div>
</div>


<div class='row' id ='posts'>
    loading...
</div>
<script>
    const postsElement = document.getElementById("posts")//get an htlml element
    postsElement.innerHTML = 'Loading ...' //set html

    
    const xhr = new XMLHttpRequest() //xhr =some class
    const method = 'GET' //Post
    const url = "/posts" 
    const responseType = "json"

    function handleDidLike(post_id, courrentCount){
        console.log(post.id, courrentCount)
    }
    function LikeBtn(post){
        return "<button class='btn btn-primary btn-sm' onclick=handleDidLike(" +post.id +"," +post.likes+")>"+ post.likes+ "Likes</button>"
    }

    function formatpostElement(post){
        var formattedposts = "<div class= 'col-10 border rounded py-3 mb-4 post'>" +"<p>"+ post.content + "</p><div class='btn-group'>" + LikeBtn(post)+ "</div></div>"
        return formattedposts
    }

    xhr.responseType = responseType   
    xhr.open(method, url)
    xhr.onload = function(){ 
        const serverResponse = xhr.response
        var listedItems = serverResponse.response
        var finalposts = "" 
        var i;
        for (i=0; i<listedItems.length; i++){
            var postobj = listedItems[i]
            var currentItem = formatpostElement(postobj)
                finalposts += currentItem
        }
        postsElement.innerHTML = finalposts
    }
    xhr.send()

</script>
{% endblock content%} 